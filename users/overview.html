

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Overview &mdash; pyregion  documentation</title>
    
    <link rel="stylesheet" href="../static/mpl.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within pyregion  documentation"
          href="../static/opensearch.xml"/>
    <link rel="top" title="pyregion  documentation" href="../index.html" />
    <link rel="up" title="Pyregion User’s Guide" href="index.html" />
    <link rel="next" title="Installing" href="installing.html" />
    <link rel="prev" title="Pyregion User’s Guide" href="index.html" /> 
  </head>
  <body>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="installing.html" title="Installing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Pyregion User’s Guide"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pyregion documentation</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Pyregion User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Overview</a><ul>
<li><a class="reference internal" href="#read-region-files">Read Region Files</a></li>
<li><a class="reference internal" href="#draw-regions-with-matplotlib">Draw Regions with Matplotlib</a></li>
<li><a class="reference internal" href="#use-regions-for-spatial-filtering">Use Regions for Spatial Filtering</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Pyregion User&#8217;s Guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="installing.html"
                        title="next chapter">Installing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/users/overview.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>pyregion is a python module to parse ds9 region files. It also support
ciao region files.</p>
<p>Please note that my main emphasis is to read in the regions files
generated by ds9 itself. It reads most of the region files created by
ds9. However, it may fail to read some of the user-created (or created
by other programs) region files, even if they can be successfully read
by ds9. Ruler, Compass and Projection type is ignored.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ds9</th>
<th class="head">pyregion + matplotlib</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="first last reference external image-reference" href="../static/region_ds9.jpg"><img alt="../images/region_ds91.jpg" src="../images/region_ds91.jpg" style="width: 300px;" /></a>
</td>
<td><a class="first last reference external image-reference" href="../static/region_mpl.png"><img alt="../images/region_mpl1.png" src="../images/region_mpl1.png" style="width: 300px;" /></a>
</td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#read-region-files" id="id1">Read Region Files</a></li>
<li><a class="reference internal" href="#draw-regions-with-matplotlib" id="id2">Draw Regions with Matplotlib</a></li>
<li><a class="reference internal" href="#use-regions-for-spatial-filtering" id="id3">Use Regions for Spatial Filtering</a></li>
</ul>
</div>
<div class="section" id="read-region-files">
<h2><a class="toc-backref" href="#id1">Read Region Files</a><a class="headerlink" href="#read-region-files" title="Permalink to this headline">¶</a></h2>
<p><em>pyregion.open</em> takes the region name as an argument and returns a
ShapeList objects, which is basically a list of Shape objects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyregion</span>
<span class="n">region_name</span> <span class="o">=</span> <span class="s">&quot;ds9.reg&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">region_name</span><span class="p">)</span>
</pre></div>
</div>
<p>You may use <em>pyregion.parse</em> if you have a string of region deniition.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">region</span> <span class="o">=</span> <span class="s">&#39;fk5;circle(290.96388,14.019167,843.31194&quot;)&#39;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
</pre></div>
</div>
<p>The shape object is a python representation of each region
definition. For example,:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyregion</span>

<span class="n">region_string</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s"># Region file format: DS9 version 4.1</span>
<span class="s"># Filename: test01.fits</span>
<span class="s">global color=green dashlist=8 3 width=1 font=&quot;helvetica 10 normal&quot; select=1 highlite=1 dash=0 fixed=0 edit=1 move=1 delete=1 include=1 source=1</span>
<span class="s">fk5</span>
<span class="s">circle(11:24:24.230,-59:15:02.20,18.5108&quot;) # color=cyan background</span>
<span class="s">box(11:24:39.213,-59:16:53.91,42.804&quot;,23.616&quot;,19.0384) # width=4</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region_string</span><span class="p">)</span>
</pre></div>
</div>
<p>And you have:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Shape : circle ( HMS(11:24:24.230),DMS(-59:15:02.20),Ang(18.5108&quot;) )</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">Shape : box ( HMS(11:24:39.213),DMS(-59:16:53.91),Ang(42.804&quot;),Ang(23.616&quot;),Number(19.0384) )</span>
</pre></div>
</div>
<p>The shape object has following attributes,</p>
<ul>
<li><p class="first">name : name of the shape. e.g., circle, box, etc..</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="go">circle</span>
</pre></div>
</div>
</li>
<li><p class="first">coord_format : coordinates format. e.g., &#8220;fk5&#8221;, &#8220;image&#8221;, &#8220;physical&#8221;, etc...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord_format</span>
<span class="go">fk5</span>
</pre></div>
</div>
</li>
<li><p class="first">coord_list : list of coordinates in <em>coord_format</em>. The coordinate
value for sky coordinate is degree.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord_list</span>
<span class="go">[171.10095833333332, -59.250611111111112, 0.0051418888888888886]</span>
</pre></div>
</div>
</li>
<li><p class="first">comment : comment string associated with the shape (can be None)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">comment</span>
<span class="go">color=cyan background</span>
</pre></div>
</div>
</li>
<li><p class="first">attr : attributes of the shape. This includes global attributes
defined by the global command and local attributes defined in the
comment. The first item is a list of key-only attributes without
associated values (e.g., background..) and the second item is a
dictionary of attributes of key-value pairs.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">[&#39;background&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">{&#39;color&#39;: &#39;cyan&#39;,</span>
<span class="go"> &#39;dash&#39;: &#39;0 &#39;,</span>
<span class="go"> &#39;dashlist&#39;: &#39;8 3 &#39;,</span>
<span class="go"> &#39;delete&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;edit&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;fixed&#39;: &#39;0 &#39;,</span>
<span class="go"> &#39;font&#39;: &#39;&quot;helvetica 10 normal&quot;&#39;,</span>
<span class="go"> &#39;highlite&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;include&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;move&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;select&#39;: &#39;1 &#39;,</span>
<span class="go"> &#39;source&#39;: &#39;1&#39;,</span>
<span class="go"> &#39;width&#39;: &#39;1 &#39;}</span>
</pre></div>
</div>
<p>Some attributes like &#8220;tag&#8221; allows multiple items and this is not
currently supported (the last definition override previous ones).</p>
</li>
</ul>
<p>The ShapeList class have a few method that could be
useful. <em>ShapeList.as_imagecoord</em> returns a new ShapeList instance
with the coordinates converted to the image coordinate. It
requires the Pyfits.Header instance.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pyfits</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&quot;t1.fits&quot;</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region_string</span><span class="p">)</span><span class="o">.</span><span class="n">as_imagecoord</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
</pre></div>
</div>
<p>The return value is a new ShapeList instance, but the coordinate is
converted to the image coordinate.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord_format</span>
<span class="go">image</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord_list</span>
<span class="go">[482.27721401429852, 472.76641383805912, 18.811792596807045]</span>
</pre></div>
</div>
</div>
<div class="section" id="draw-regions-with-matplotlib">
<h2><a class="toc-backref" href="#id2">Draw Regions with Matplotlib</a><a class="headerlink" href="#draw-regions-with-matplotlib" title="Permalink to this headline">¶</a></h2>
<p>pyregion can help you draw the ds9 region with
matplotlib. <em>ShapeList.get_mpl_patches_texts</em> returns a list of
matplotlib.Artist</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region_string</span><span class="p">)</span><span class="o">.</span><span class="n">as_imagecoord</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="n">patch_list</span><span class="p">,</span> <span class="n">artist_list</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_mpl_patches_texts</span><span class="p">()</span>
</pre></div>
</div>
<p>The first item is a list of matplotlib.Patch, and the second one is
other kind of artists (usually Text). It is your responsibility to add
these to the axes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ax is a mpl Axes object</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_list</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">artist_list</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../figures/test_region_drawing.py">Source code</a>, <a class="reference external" href="../figures/test_region_drawing.png">png</a>, <a class="reference external" href="../figures/test_region_drawing.hires.png">hires.png</a>, <a class="reference external" href="../figures/test_region_drawing.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../images/test_region_drawing.png" src="../images/test_region_drawing.png" />
</div>
<p>The (optional) argument of the <em>get_mpl_patches_texts</em> method is a
callable object that takes the shape object as an argument and returns
a dictionary object that will be used as a keyword arguments (e.g.,
colors and line width) for creating the mpl artists. By default, it
uses pyregion.mpl_helper.properties_func_default, which try to respect
the ds9 attributes. However, the colors (and other attributes) of some
complex shapes are not correctly handled as shown in above example,
and you need to manually adjust the associated attributes of patches.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>

<span class="kn">import</span> <span class="nn">pyregion</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span> <span class="k">as</span> <span class="n">pyfits</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pyfits</span>

<span class="c"># read in the image</span>
<span class="n">xray_name</span><span class="o">=</span><span class="s">&quot;pspc_skyview.fits&quot;</span>
<span class="n">f_xray</span> <span class="o">=</span> <span class="n">pyfits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">xray_name</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pywcsgrid2</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">pywcsgrid2</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">f_xray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_xray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.00038</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&quot;lower&quot;</span><span class="p">)</span>

<span class="n">reg_name</span> <span class="o">=</span> <span class="s">&quot;test.reg&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">reg_name</span><span class="p">)</span><span class="o">.</span><span class="n">as_imagecoord</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="n">f_xray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pyregion.mpl_helper</span> <span class="kn">import</span> <span class="n">properties_func_default</span>

<span class="c"># Use custom function for patch attribute</span>
<span class="k">def</span> <span class="nf">fixed_color</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">saved_attrs</span><span class="p">):</span>

    <span class="n">attr_list</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="o">=</span> <span class="n">saved_attrs</span>
    <span class="n">attr_dict</span><span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;red&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">properties_func_default</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">attr_list</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">kwargs</span>

<span class="c"># select region shape with tag==&quot;Group 1&quot;</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">ShapeList</span><span class="p">([</span><span class="n">rr</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;tag&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;Group 1&quot;</span><span class="p">])</span>
<span class="n">patch_list1</span><span class="p">,</span> <span class="n">artist_list1</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">get_mpl_patches_texts</span><span class="p">(</span><span class="n">fixed_color</span><span class="p">)</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">ShapeList</span><span class="p">([</span><span class="n">rr</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span> <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">attr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;tag&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;Group 1&quot;</span><span class="p">])</span>
<span class="n">patch_list2</span><span class="p">,</span> <span class="n">artist_list2</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_mpl_patches_texts</span><span class="p">()</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patch_list1</span> <span class="o">+</span> <span class="n">patch_list2</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">artist_list1</span> <span class="o">+</span> <span class="n">artist_list2</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../figures/test_region_drawing2.py">Source code</a>, <a class="reference external" href="../figures/test_region_drawing2.png">png</a>, <a class="reference external" href="../figures/test_region_drawing2.hires.png">hires.png</a>, <a class="reference external" href="../figures/test_region_drawing2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../images/test_region_drawing2.png" src="../images/test_region_drawing2.png" />
</div>
</div>
<div class="section" id="use-regions-for-spatial-filtering">
<h2><a class="toc-backref" href="#id3">Use Regions for Spatial Filtering</a><a class="headerlink" href="#use-regions-for-spatial-filtering" title="Permalink to this headline">¶</a></h2>
<p><em>pyregion</em> includes some basic spatial filter support.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyregion._region_filter</span> <span class="kn">as</span> <span class="nn">filter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfilter</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">filter</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfilter</span><span class="o">.</span><span class="n">inside1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfilter</span><span class="o">.</span><span class="n">inside1</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myfilter</span><span class="o">.</span><span class="n">inside</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="go">array([False,  True], dtype=bool)</span>
</pre></div>
</div>
<p>ShapeList.get_filter method returns the filter from the parsed
region. The filter is meant to be used in the image coordinate, thus
you need to convert the region to the image coordinate before calling
get_filter.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region_string</span><span class="p">)</span><span class="o">.</span><span class="n">as_imagecoord</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
<span class="n">myfilter</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_filter</span><span class="p">()</span>
<span class="n">myfilter</span><span class="o">.</span><span class="n">inside1</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>The returned filter has a <em>mask</em> method that creates an 2d mask. You
can create the mask directly from the ShapeList object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region_string</span><span class="p">)</span>
<span class="n">mymask</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">get_mask</span><span class="p">(</span><span class="n">hdu</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p>It will creates an mask in the shape of the given hdu image (the mask
will be created after transforming the region to the image coordinate if
necessary).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pyregion</span>

<span class="n">region</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">image</span>
<span class="s">circle(100, 100, 80)</span>
<span class="s">box(200, 150, 150, 120, 0)</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">pyregion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">mask_1or2</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_mask</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span>

<span class="n">myfilter</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_filter</span><span class="p">()</span>
<span class="n">mask_1and2</span> <span class="o">=</span> <span class="p">(</span><span class="n">myfilter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">myfilter</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mask</span><span class="p">((</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_1or2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&quot;lower&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask_1and2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&quot;lower&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&quot;nearest&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../figures/demo_filter_mask.py">Source code</a>, <a class="reference external" href="../figures/demo_filter_mask.png">png</a>, <a class="reference external" href="../figures/demo_filter_mask.hires.png">hires.png</a>, <a class="reference external" href="../figures/demo_filter_mask.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../images/demo_filter_mask.png" src="../images/demo_filter_mask.png" />
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="installing.html" title="Installing"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Pyregion User’s Guide"
             >previous</a> |</li>
        <li><a href="../index.html">pyregion documentation</a>|&nbsp;</li>

          <li><a href="index.html" >Pyregion User&#8217;s Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009, Jae-Joon Lee.
      Last updated on May 06, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>